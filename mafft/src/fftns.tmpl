#! /bin/sh
if [ $MAFFT_BINARIES ]; then
	prefix=$MAFFT_BINARIES
else
	prefix=_PREFIX
fi

#TMPFILE=`mktemp  -d ${tempfoo}.XXXXXXX` || exit 1
TMPFILE=/tmp/`basename $0`.`whoami`.$$.`date +%y%m%d%H%M%S`
umask 077
mkdir  $TMPFILE  || exit 1
trap "rm -r $TMPFILE; exit 1" 2
er=0;
case $# in
	1)
		tr "\r" "\n" < $1 > $TMPFILE/infile || er=1
		n=2
		;;
	2)
		tr "\r" "\n" < $2 > $TMPFILE/infile || er=1
		n=`expr $1 - 0`          || er=1
		if [ $er -eq 0 ]; then
			if [ $n -lt 1 ]; then
				er=1;
			fi
		fi
		;;
	*)
		er=1;
		;;
esac
if [ $er -eq 1 ]; then
	rm -r $TMPFILE
	echo "Usage: `basename $0` [number of cycles] inputfile (fasta format)" > /dev/tty;
	exit 1; 
fi

(
cd $TMPFILE;
if [ -s infile ]; then
	$prefix/sextet5 < infile > /dev/null        || exit 1
	$prefix/tbfast  -FAx < infile   > /dev/null || exit 1
	while [ $n -gt 1 ]
	do
		$prefix/tbfast  -JFAx < pre > /dev/null || exit 1
		n=`expr $n - 1`
	done
	cat  < pre             || exit 1
	exit 0;
else
	echo "Cannot open $TMPFILE/infile." > /dev/tty; exit 1;
fi
)
rm -r $TMPFILE
exit 0;
